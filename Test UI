local UIS = game:GetService("UserInputService")
local Tween = game:GetService("TweenService")
local Run = game:GetService("RunService")
local Core = game:GetService("CoreGui")
local LP = game:GetService("Players").LocalPlayer
local Mouse = LP:GetMouse()

local sh_lib = {}

local function Create(Class, Parent, Props)
    local Obj = Instance.new(Class)
    for i, v in pairs(Props) do Obj[i] = v end
    if Parent then Obj.Parent = Parent end
    return Obj
end

function sh_lib:CreateWindow(Config)
    local TitleText = Config[1] or "SH.LIB | Premium MM2"
    
    local ScreenGui = Create("ScreenGui", Core, {Name = "SH_UI", ResetOnSpawn = false})
    
    local Shadow = Create("ImageLabel", ScreenGui, {
        Name = "Shadow",
        Size = UDim2.fromOffset(670, 480),
        Position = UDim2.new(0.5, -335, 0.5, -240),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6014264792",
        ImageColor3 = Color3.fromRGB(255, 50, 150),
        ImageTransparency = 1,
        ZIndex = 0
    })

    local MainFrame = Create("Frame", ScreenGui, {
        Name = "Main",
        Size = UDim2.fromOffset(0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        BackgroundColor3 = Color3.fromRGB(20, 20, 25),
        BorderSizePixel = 0,
        ClipsDescendants = true,
        BackgroundTransparency = 1
    })
    Create("UICorner", MainFrame, {CornerRadius = UDim.new(0, 15)})
    
    local Stroke = Create("UIStroke", MainFrame, {
        Color = Color3.fromRGB(255, 50, 150),
        Thickness = 1.5,
        Transparency = 1
    })

    local SideBar = Create("Frame", MainFrame, {
        Size = UDim2.new(0, 160, 1, 0),
        BackgroundColor3 = Color3.fromRGB(15, 15, 20),
        BorderSizePixel = 0
    })
    Create("UICorner", SideBar, {CornerRadius = UDim.new(0, 15)})

    local Title = Create("TextLabel", MainFrame, {
        Size = UDim2.new(0, 160, 0, 50),
        Text = TitleText,
        Font = "GothamBold",
        TextSize = 14,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 1,
        ZIndex = 2
    })

    local TabHolder = Create("ScrollingFrame", SideBar, {
        Size = UDim2.new(1, 0, 1, -60),
        Position = UDim2.fromOffset(0, 60),
        BackgroundTransparency = 1,
        ScrollBarThickness = 0,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = "Y"
    })
    Create("UIListLayout", TabHolder, {Padding = UDim.new(0, 2), HorizontalAlignment = "Center"})

    local ContainerHolder = Create("Frame", MainFrame, {
        Size = UDim2.new(1, -180, 1, -20),
        Position = UDim2.fromOffset(175, 10),
        BackgroundTransparency = 1
    })

    Tween:Create(MainFrame, TweenInfo.new(0.6, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
        Size = UDim2.fromOffset(630, 440),
        Position = UDim2.new(0.5, -315, 0.5, -220),
        BackgroundTransparency = 0
    }):Play()
    
    Tween:Create(Shadow, TweenInfo.new(0.8, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
        ImageTransparency = 0.5
    }):Play()

    Tween:Create(Stroke, TweenInfo.new(0.8), {Transparency = 0.5}):Play()

    local dragStart, startPos, dragging
    MainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true; dragStart = input.Position; startPos = MainFrame.Position
        end
    end)
    UIS.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            Shadow.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X - 20, startPos.Y.Scale, startPos.Y.Offset + delta.Y - 20)
        end
    end)
    UIS.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)

    local FirstTab = true
    function sh_lib:MakeTab(TConfig)
        local Name = TConfig[1] or "Tab"
        local TabBtn = Create("TextButton", TabHolder, {
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundTransparency = 1,
            Text = Name,
            Font = "GothamMedium",
            TextSize = 13,
            TextColor3 = Color3.fromRGB(150, 150, 150)
        })

        local Indicator = Create("Frame", TabBtn, {
            Size = UDim2.new(0, 2, 0, 15),
            Position = UDim2.new(0, 5, 0.5, -7),
            BackgroundColor3 = Color3.fromRGB(255, 50, 150),
            Visible = false
        })

        local Container = Create("ScrollingFrame", ContainerHolder, {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Visible = false,
            ScrollBarThickness = 0,
            AutomaticCanvasSize = "Y"
        })
        Create("UIListLayout", Container, {Padding = UDim.new(0, 10)})

        TabBtn.MouseButton1Click:Connect(function()
            for _, v in pairs(TabHolder:GetChildren()) do 
                if v:IsA("TextButton") then 
                    v.TextColor3 = Color3.fromRGB(150, 150, 150)
                    v.Frame.Visible = false
                end 
            end
            for _, v in pairs(ContainerHolder:GetChildren()) do v.Visible = false end
            TabBtn.TextColor3 = Color3.fromRGB(255, 50, 150)
            Indicator.Visible = true
            Container.Visible = true
        end)

        if FirstTab then 
            FirstTab = false
            TabBtn.TextColor3 = Color3.fromRGB(255, 50, 150)
            Indicator.Visible = true
            Container.Visible = true 
        end

        local Elements = {}
        function Elements:AddButton(BConfig)
            local BName = BConfig[1] or "Button"
            local Callback = BConfig[2] or function() end
            local B = Create("TextButton", Container, {
                Size = UDim2.new(1, -10, 0, 40),
                BackgroundColor3 = Color3.fromRGB(28, 28, 33),
                Text = BName,
                Font = "GothamMedium",
                TextColor3 = Color3.fromRGB(255, 255, 255),
                TextSize = 12
            })
            Create("UICorner", B, {CornerRadius = UDim.new(0, 8)})
            local S = Create("UIStroke", B, {Color = Color3.fromRGB(255, 50, 150), Thickness = 1, Transparency = 0.8})
            
            B.MouseButton1Click:Connect(function()
                Tween:Create(S, TweenInfo.new(0.2), {Transparency = 0}):Play()
                task.wait(0.1)
                Tween:Create(S, TweenInfo.new(0.2), {Transparency = 0.8}):Play()
                pcall(Callback)
            end)
        end
        return Elements
    end
    return sh_lib
end

return sh_lib
